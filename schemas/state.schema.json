{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://nldevicessetup.local/schemas/state.schema.json",
  "title": "DeviceState",
  "description": "Current state of a device (what's installed and configured)",
  "type": "object",
  "required": ["last_updated"],
  "properties": {
    "last_updated": {
      "type": "string",
      "description": "ISO 8601 timestamp of last state update",
      "format": "date-time"
    },
    "software": {
      "type": "object",
      "description": "Installed software with versions and install timestamps",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "version": {
            "type": "string",
            "description": "Installed version"
          },
          "installed": {
            "type": "string",
            "description": "ISO 8601 timestamp when installed",
            "format": "date-time"
          },
          "recipe": {
            "type": "string",
            "description": "Recipe that installed this software"
          }
        },
        "required": ["version", "installed"]
      }
    },
    "optimizations": {
      "type": "object",
      "description": "Applied optimizations by category",
      "properties": {
        "network": {
          "type": "object",
          "description": "Network optimizations",
          "properties": {
            "nagle_disabled": { "type": "boolean" },
            "tcp_nodelay": { "type": "boolean" },
            "tcp_low_latency": { "type": "boolean" },
            "eee_disabled": { "type": "boolean" },
            "flow_control_disabled": { "type": "boolean" },
            "qos_enabled": { "type": "boolean" }
          },
          "additionalProperties": true
        },
        "power": {
          "type": "object",
          "description": "Power management settings",
          "properties": {
            "plan": {
              "type": "string",
              "enum": ["high_performance", "balanced", "power_saver"]
            },
            "sleep": {
              "type": "string",
              "enum": ["disabled", "enabled"]
            },
            "hibernate": {
              "type": "string",
              "enum": ["disabled", "enabled"]
            },
            "usb_selective_suspend": {
              "type": "string",
              "enum": ["disabled", "enabled"]
            }
          },
          "additionalProperties": true
        },
        "audio": {
          "type": "object",
          "description": "Audio/MMCSS optimizations",
          "properties": {
            "mmcss_priority": {
              "type": "string",
              "enum": ["high", "normal", "low"]
            },
            "timer_resolution": {
              "type": "string",
              "description": "Timer resolution in ms"
            },
            "realtime_limits": { "type": "boolean" }
          },
          "additionalProperties": true
        },
        "visual": {
          "type": "object",
          "description": "Visual/UI optimizations",
          "properties": {
            "dark_mode": { "type": "boolean" },
            "transparency_disabled": { "type": "boolean" },
            "animations_disabled": { "type": "boolean" }
          },
          "additionalProperties": true
        },
        "services": {
          "type": "object",
          "description": "Disabled services",
          "additionalProperties": {
            "type": "string",
            "enum": ["disabled", "manual", "automatic"]
          }
        }
      },
      "additionalProperties": true
    },
    "applied_recipes": {
      "type": "array",
      "description": "List of recipes that have been applied",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Recipe name"
          },
          "applied_at": {
            "type": "string",
            "description": "ISO 8601 timestamp",
            "format": "date-time"
          },
          "session_id": {
            "type": "string",
            "description": "Execution session ID for history lookup"
          }
        },
        "required": ["name", "applied_at"]
      }
    }
  },
  "additionalProperties": false
}
